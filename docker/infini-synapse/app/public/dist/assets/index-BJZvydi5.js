import{d as j,b8 as O,b9 as D,ba as N,bb as F,bc as S,r as w,e as G,a2 as z,q as v,B as P,E as c,c as r,v as T,K as B,Q as K,F as d,bd as L,a1 as U,be as M,Y as W,al as H,a9 as X,bf as Q,bg as Y,n as J,X as k,aD as Z,G as y,as as b,aX as R,bh as ee,bi as te,x as oe,A as ne,aW as ae}from"./index-3Y2L8Jwy.js";import{f as se}from"./dateUtil-Dl3Begyh.js";import{T as h}from"./index-DlLSGNDJ.js";import{T as ie,a as le}from"./index-B43acP7c.js";import"./index-DmAlrLea.js";import{f as re,s as A}from"./common-DYfstu_g.js";import{u as pe}from"./dynamic-table-iP8S6dbO.js";import"./ApiSelect.vue_vue_type_script_setup_true_lang-DOJvQ0AM.js";import"./index.vue_vue_type_style_index_0_lang-BSu6Ro7B.js";import{u as ue}from"./useFormModal-46WjzGC2.js";import"./index-V-ILxsgN.js";import"./_baseUniq-GBykg-gc.js";import"./_arrayIncludesWith-DbV0gfeD.js";import"./collapseMotion-CaWKbpu5.js";import"./useRefs-Coab_dzV.js";import"./pick-zyaBKG-Z.js";import"./isMobile-BbN7I0i_.js";import"./useMergedState-fatNDSdO.js";import"./PlusOutlined-BOyfvu-B.js";import"./cloneDeep-CPvluXjr.js";import"./useFlexGapSupport-DgSEdSzR.js";import"./debounce-DqV1iSPJ.js";import"./QuestionCircleOutlined-Dfq7iidB.js";import"./_castArrayLikeObject-Cmo_jate.js";import"./index-CujHLiDk.js";import"./move-sJvsL9am.js";import"./RightOutlined-CveUqwtZ.js";import"./index-B8FgbjNq.js";import"./index-Ds4E8NUa.js";import"./DownOutlined-Cygx6sjI.js";import"./CheckOutlined-TKs2sWhg.js";import"./VerticalRightOutlined-BQJHozSo.js";import"./index-1O-QuJ0e.js";import"./FullscreenOutlined-CYkmFycF.js";import"./index-CLWdOiDS.js";import"./index-BxFhrhAI.js";import"./index-CF01qfge.js";import"./LeftOutlined-PhT-UbT5.js";import"./zh_CN-CAyhejr6.js";import"./index-CPSWVOFO.js";import"./FileOutlined-BjpGz_RI.js";import"./Text-C1nkbX9y.js";import"./EnterOutlined-DyjPwoPv.js";import"./CopyOutlined-CAxvSpc5.js";import"./isNumber-CbAoyECd.js";import"./index-xEjtWmqS.js";import"./index-CsNtKM2u.js";import"./index-DbtwYZ6E.js";const ce=["title","onClick"],de=j({inheritAttrs:!1,__name:"IconPicker",props:O(D,{value:{},valueModifiers:{}}),emits:["update:value"],setup(e){N();const l=F(e,"value"),n=Object.entries(S).reduce((t,[s,i])=>(t[s]=Object.keys(i.icons).map(_=>({name:`${i.prefix}:${_}`})),t),{全部:Object.values(S).flatMap(t=>Object.keys(t.icons).map(s=>({name:`${t.prefix}:${s}`})))}),p=w(!1),a=w("全部"),m=w(""),I=G(()=>n[a.value].filter(s=>s.name.includes(m.value))),x=z(t=>{m.value=t.target.value},100),o=t=>{l.value=t,p.value=!1};return(t,s)=>{const i=ie,_=le,C=X,q=Q,E=Y;return v(),P(E,null,{default:c(()=>[r(q,{open:p.value,"onUpdate:open":s[2]||(s[2]=u=>p.value=u),placement:"bottomLeft","overlay-inner-style":{paddingTop:0},trigger:"click"},{title:c(()=>[r(_,{activeKey:a.value,"onUpdate:activeKey":s[0]||(s[0]=u=>a.value=u),size:"small","tab-bar-style":{marginBottom:"8px"}},{default:c(()=>[(v(!0),T(B,null,K(d(n),(u,g)=>(v(),P(i,{key:g,tab:g},null,8,["tab"]))),128))]),_:1},8,["activeKey"]),r(C,{autofocus:"","allow-clear":"",placeholder:`从“${a.value}”中搜索图标`,onChange:d(x)},null,8,["placeholder","onChange"])]),content:c(()=>[r(d(L),{class:"select-box h-300px min-w-350px",items:I.value,"key-field":"name","item-size":38,"grid-items":9,"item-secondary-size":38},{default:c(({item:u})=>[(v(),T("div",{key:u.name,title:u.name,class:U([{active:l.value==u.name},"select-box-item flex m-[2px] p-[6px]"]),onClick:g=>o(u.name)},[r(d(M),{icon:u.name,class:"text-[20px]"},null,8,["icon"])],10,ce))]),_:1},8,["items"])]),default:c(()=>[r(C,W(t.$attrs,{value:l.value,"onUpdate:value":s[1]||(s[1]=u=>l.value=u),placeholder:t.placeholder,"allow-clear":""}),H({_:2},[l.value?{name:"prefix",fn:c(()=>[r(d(M),{icon:l.value,class:"text-[20px]"},null,8,["icon"])]),key:"0"}:void 0]),1040,["value","placeholder"])]),_:1},8,["open"])]),_:1})}}}),me=J(de,[["__scopeId","data-v-1c8e3fb6"]]);function $(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Z(e)}const fe=e=>{switch(e){case 0:return r(h,{color:"warning"},{default:()=>[y("目录")]});case 1:return r(h,{color:"success"},{default:()=>[y("菜单")]});case 2:return r(h,{color:"error"},{default:()=>[y("权限")]});default:return""}},be=[{title:"名称",dataIndex:"name",align:"left",fixed:"left",width:200},{title:"图标",width:40,dataIndex:"icon",hideInSearch:!0,customRender:({record:e})=>e.icon&&r(k,{icon:e.icon,size:"22"},null)},{title:"类型",width:80,dataIndex:"type",hideInSearch:!0,customRender:({record:e})=>fe(e.type)},{title:"节点路由",dataIndex:"path",width:180,ellipsis:!0},{title:"文件路径",width:180,dataIndex:"component"},{title:"权限标识",width:180,dataIndex:"permission",hideInSearch:!0,customRender:({record:e})=>e.permission&&r(h,{color:"processing"},{default:()=>[e.permission]})},{title:"排序",width:50,dataIndex:"orderNo",hideInSearch:!0},{title:"路由缓存",dataIndex:"keepalive",width:80,hideInSearch:!0,customRender:({record:e})=>e.type===1&&(e.keepAlive?"是":"否")},{title:"是否显示",dataIndex:"show",width:80,hideInSearch:!0,customRender:({record:e})=>{const n=~~e.show===1,p=n?"green":"red",a=n?"显示":"隐藏";return r(h,{color:p},$(a)?a:{default:()=>[a]})}},{title:"状态",dataIndex:"status",width:80,hideInSearch:!0,customRender:({record:e})=>{const n=~~e.status===1,p=n?"green":"red",a=n?"启用":"停用";return r(h,{color:p},$(a)?a:{default:()=>[a]})}},{title:"更新时间",width:180,dataIndex:"updatedAt",hideInSearch:!0,customRender({text:e}){return se(e)}}],ye=e=>e===0,V=e=>e===1,f=e=>e===2,he=()=>[{field:"type",component:"RadioGroup",label:"菜单类型",defaultValue:0,rules:[{required:!0,type:"number"}],componentProps:{options:[{label:"目录",value:0},{label:"菜单",value:1},{label:"权限",value:2}]}},{field:"name",component:"Input",label:({formModel:e})=>f(e.type)?"权限名称":"节点名称",rules:[{required:!0,type:"string"}]},{field:"parentId",component:"TreeSelect",label:"上级节点",componentProps:{fieldNames:{label:"name",value:"id"},request:async({schema:e,formModel:l})=>{const n=await b.systemMenu.menuList({}),p=[-1].concat(re(n,l.parentId)||[]);return e.value.componentProps.treeDefaultExpandedKeys=p,[{id:-1,name:"根目录",children:n}]},getPopupContainer:()=>document.body},rules:[{required:!0,type:"number"}]},{field:"path",component:"Input",label:"路由地址",vIf:({formModel:e})=>!f(e.type),rules:[{required:!0,type:"string"}]},{field:"permission",component:"Input",label:"权限",helpMessage:"对应控制器中定义的权限字符，如：@Perm('system:menu:list'))",vIf:({formModel:e})=>!ye(e.type),required:({formModel:e})=>f(e.type),afterSlot:({schema:e,formInstance:l,formModel:n})=>e.value.component==="Input"?R(k,{icon:"ant-design:folder-open-outlined",title:"选择权限",class:"ml-[12px] cursor-pointer",onclick:async()=>{const p=await b.systemMenu.menuGetPermissions();typeof n.permission=="string"&&(n.permission=n.permission.split(":")),l.updateSchema({field:"permission",component:"Cascader",componentProps:{displayRender:({labels:a})=>a.join(":"),options:p.reduce((a,m)=>(A(m,a,":"),a),[])}})}}):R(k,{icon:"ant-design:edit-outlined",title:"手动输入",class:"ml-[12px] cursor-pointer",onclick:()=>{Array.isArray(n.permission)&&(n.permission=n.permission.join(":")),l.updateSchema({field:"permission",component:"Input"})}})},{field:"component",component:"Cascader",label:"文件路径",vIf:({formModel:e})=>V(e.type)&&!e.isExt,componentProps:{options:Object.keys(ee).reduce((e,l)=>(A(l,e,"/"),e),[])},rules:[{required:!0,type:"array"}]},{field:"icon",component:()=>me,label:"节点图标",vIf:({formModel:e})=>!f(e.type)},{field:"orderNo",component:"InputNumber",label:"排序号",defaultValue:255,componentProps:{style:{width:"100%"}}},{field:"isExt",component:"RadioGroup",label:"是否外链",defaultValue:!1,helpMessage:"选择是外链则路由地址需要以`http(s)://`开头",colProps:{span:12},componentProps:{optionType:"button",buttonStyle:"solid",options:[{label:"是",value:!0},{label:"否",value:!1}]},vIf:({formModel:e})=>!f(e.type)},{field:"extOpenMode",component:"RadioGroup",label:"打开方式",defaultValue:1,vIf:({formModel:e})=>!f(e.type)&&e.isExt,colProps:{span:12},componentProps:{optionType:"button",buttonStyle:"solid",options:[{label:"新窗口打开",value:1},{label:"内嵌页打开",value:2}]}},{field:"keepAlive",component:"RadioGroup",label:"是否缓存",defaultValue:0,vIf:({formModel:e})=>V(e.type),colProps:{span:12},componentProps:{optionType:"button",buttonStyle:"solid",options:[{label:"是",value:1},{label:"否",value:0}]}},{field:"show",component:"RadioGroup",label:"是否显示",defaultValue:1,colProps:{span:12},helpMessage:"会生成路由,但左侧菜单不可见",componentProps:{optionType:"button",buttonStyle:"solid",options:[{label:"是",value:1},{label:"否",value:0}]},vIf:({formModel:e})=>!f(e.type)},{field:"activeMenu",component:"Input",label:"高亮菜单项",colProps:{span:12},helpMessage:"值为某个的节点的路由地址(可设置当前路由高亮的菜单项，多用于详情页)",componentProps:{placeholder:"需要高亮的菜单项(节点名称)"},vIf:({formModel:e})=>!e.show&&!f(e.type)},{field:"status",label:"状态",component:"RadioGroup",defaultValue:1,helpMessage:"不会生成路由,同时左侧菜单不可见",componentProps:{optionType:"button",buttonStyle:"solid",options:[{label:"启用",value:1},{label:"禁用",value:0}]}}],ve={class:"flex gap-2 ml-2"},mt=j({name:"SysMenu",__name:"index",setup(e){const[l,n]=pe({pagination:!1,size:"small",rowKey:"id",bordered:!0,autoHeight:!0}),[p]=ue(),a=ae();te(document.documentElement,()=>{var t;const o=(t=a==null?void 0:a.proxy)==null?void 0:t.$el;o&&n.setProps({scroll:{x:window.innerWidth>2e3?o.offsetWidth-20:2e3}})});const m=async o=>{var s;const[t]=await p({modalProps:{title:`${o.id?"编辑":"新增"}菜单`,width:700,onFinish:async i=>{o.id&&(i.menuId=o.id),Array.isArray(i.component)&&(i.component=i.component.join("/")),Array.isArray(i.permission)&&(i.permission=i.permission.join(":")),i.parentId===-1&&Reflect.deleteProperty(i,"parentId"),o.id?await b.systemMenu.menuUpdate({id:o.id},i):await b.systemMenu.menuCreate(i),n.reload()}},formProps:{labelWidth:100,schemas:he()}});t==null||t.setFieldsValue({...o,icon:o.icon??"",parentId:o.parentId??-1,component:(s=o.component)==null?void 0:s.split("/")})},I=async o=>{await b.systemMenu.menuDelete({id:o.id}),n.reload()},x=[...be,{title:"操作",width:160,dataIndex:"ACTION",hideInSearch:!0,fixed:"right",actions:({record:o})=>[{label:"编辑",auth:{perm:"system:menu:update",effect:"disable"},onClick:()=>m(o)},{label:"新增",auth:{perm:"system:menu:create",effect:"disable"},disabled:o.type===2||o.status===0,onClick:()=>m({parentId:o.id})},{label:"删除",auth:"system:menu:delete",popConfirm:{title:"你确定要删除吗？",placement:"left",onConfirm:()=>I(o)}}]}];return(o,t)=>{const s=ne("a-button");return v(),P(d(l),{"header-title":"菜单管理","data-request":d(b).systemMenu.menuList,columns:x},{afterHeaderTitle:c(()=>[oe("div",ve,[r(s,{onClick:d(n).expandAll},{default:c(()=>t[1]||(t[1]=[y("展开全部")])),_:1},8,["onClick"]),r(s,{onClick:d(n).collapseAll},{default:c(()=>t[2]||(t[2]=[y("折叠全部")])),_:1},8,["onClick"])])]),toolbar:c(()=>[r(s,{type:"primary",disabled:!o.$auth("system:menu:create"),onClick:t[0]||(t[0]=i=>m({}))},{default:c(()=>t[3]||(t[3]=[y(" 新增 ")])),_:1},8,["disabled"])]),_:1},8,["data-request"])}}});export{mt as default};
