import{d as V,bj as N,bk as O,bl as z,bm as D,bn as S,r as w,b as F,a0 as B,n as v,B as k,E as c,c as r,q as T,J as G,N as K,F as d,bo as L,$ as U,bp as M,W,aj as H,a7 as J,bq as Q,br as X,k as Y,V as P,az as Z,x as y,aq as b,b7 as R,bs as ee,bt as te,v as oe,A as ne,b6 as ae}from"./index-DfFq98iI.js";import{f as se}from"./dateUtil-Yht9XRPF.js";import{T as h}from"./index-Dlnok0kj.js";import{T as ie,a as le}from"./index-Bcu5QuUv.js";import"./index-DgRcuS_8.js";import{f as re,s as $}from"./common-D3oBhk5u.js";import{u as pe}from"./dynamic-table-BvYG2uaQ.js";import"./ApiSelect.vue_vue_type_script_setup_true_lang-DfpO8rn_.js";import"./index.vue_vue_type_style_index_0_lang-BfNlMPF9.js";import{u as ue}from"./useFormModal-BxahiGiP.js";import"./index-C7momlVE.js";import"./_baseUniq-Ye7AfUyy.js";import"./_arrayIncludesWith-DbV0gfeD.js";import"./collapseMotion-Cr6AhTec.js";import"./useRefs-DiW-EIw3.js";import"./pick-CFxAzuma.js";import"./isMobile-BbN7I0i_.js";import"./useMergedState-DSTrXYcS.js";import"./PlusOutlined-BejYLDml.js";import"./cloneDeep-7HLhhoFu.js";import"./useFlexGapSupport-CQZF-aUP.js";import"./debounce-Df4UesAS.js";import"./QuestionCircleOutlined-ssBuu4EU.js";import"./_castArrayLikeObject-BrPOkB4F.js";import"./index-BLXV14Bz.js";import"./move-DkkIAjWs.js";import"./RightOutlined-BZ2pGhZt.js";import"./index-B8_A7MkL.js";import"./index-BqNSHfyN.js";import"./DownOutlined-8VBGnHmu.js";import"./CheckOutlined-Cf9d_uMY.js";import"./VerticalRightOutlined-BIMOJVTh.js";import"./index-DlL-KCqt.js";import"./index-LC6BztS_.js";import"./index-DKBsGozE.js";import"./index-BBU6WuBs.js";import"./LeftOutlined-BjLfI7Ei.js";import"./zh_CN-CAyhejr6.js";import"./index-hVU4LEoT.js";import"./FileOutlined-oE-j5Vil.js";import"./Text-DvgTWTh8.js";import"./EnterOutlined-_30rq_Kv.js";import"./CopyOutlined-5vJVwE4n.js";import"./isNumber-Bv4T1dtx.js";import"./index-D9hduaB1.js";import"./index-Cd8zMccQ.js";const ce=["title","onClick"],de=V({inheritAttrs:!1,__name:"IconPicker",props:N(O,{value:{},valueModifiers:{}}),emits:["update:value"],setup(e){z();const l=D(e,"value"),n=Object.entries(S).reduce((t,[s,i])=>(t[s]=Object.keys(i.icons).map(_=>({name:`${i.prefix}:${_}`})),t),{全部:Object.values(S).flatMap(t=>Object.keys(t.icons).map(s=>({name:`${t.prefix}:${s}`})))}),p=w(!1),a=w("全部"),m=w(""),I=F(()=>n[a.value].filter(s=>s.name.includes(m.value))),x=B(t=>{m.value=t.target.value},100),o=t=>{l.value=t,p.value=!1};return(t,s)=>{const i=ie,_=le,C=J,q=Q,E=X;return v(),k(E,null,{default:c(()=>[r(q,{open:p.value,"onUpdate:open":s[2]||(s[2]=u=>p.value=u),placement:"bottomLeft","overlay-inner-style":{paddingTop:0},trigger:"click"},{title:c(()=>[r(_,{activeKey:a.value,"onUpdate:activeKey":s[0]||(s[0]=u=>a.value=u),size:"small","tab-bar-style":{marginBottom:"8px"}},{default:c(()=>[(v(!0),T(G,null,K(d(n),(u,g)=>(v(),k(i,{key:g,tab:g},null,8,["tab"]))),128))]),_:1},8,["activeKey"]),r(C,{autofocus:"","allow-clear":"",placeholder:`从“${a.value}”中搜索图标`,onChange:d(x)},null,8,["placeholder","onChange"])]),content:c(()=>[r(d(L),{class:"select-box h-300px min-w-350px",items:I.value,"key-field":"name","item-size":38,"grid-items":9,"item-secondary-size":38},{default:c(({item:u})=>[(v(),T("div",{key:u.name,title:u.name,class:U([{active:l.value==u.name},"select-box-item flex m-[2px] p-[6px]"]),onClick:g=>o(u.name)},[r(d(M),{icon:u.name,class:"text-[20px]"},null,8,["icon"])],10,ce))]),_:1},8,["items"])]),default:c(()=>[r(C,W(t.$attrs,{value:l.value,"onUpdate:value":s[1]||(s[1]=u=>l.value=u),placeholder:t.placeholder,"allow-clear":""}),H({_:2},[l.value?{name:"prefix",fn:c(()=>[r(d(M),{icon:l.value,class:"text-[20px]"},null,8,["icon"])]),key:"0"}:void 0]),1040,["value","placeholder"])]),_:1},8,["open"])]),_:1})}}}),me=Y(de,[["__scopeId","data-v-1c8e3fb6"]]);function A(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Z(e)}const fe=e=>{switch(e){case 0:return r(h,{color:"warning"},{default:()=>[y("目录")]});case 1:return r(h,{color:"success"},{default:()=>[y("菜单")]});case 2:return r(h,{color:"error"},{default:()=>[y("权限")]});default:return""}},be=[{title:"名称",dataIndex:"name",align:"left",fixed:"left",width:200},{title:"图标",width:40,dataIndex:"icon",hideInSearch:!0,customRender:({record:e})=>e.icon&&r(P,{icon:e.icon,size:"22"},null)},{title:"类型",width:80,dataIndex:"type",hideInSearch:!0,customRender:({record:e})=>fe(e.type)},{title:"节点路由",dataIndex:"path",width:180,ellipsis:!0},{title:"文件路径",width:180,dataIndex:"component"},{title:"权限标识",width:180,dataIndex:"permission",hideInSearch:!0,customRender:({record:e})=>e.permission&&r(h,{color:"processing"},{default:()=>[e.permission]})},{title:"排序",width:50,dataIndex:"orderNo",hideInSearch:!0},{title:"路由缓存",dataIndex:"keepalive",width:80,hideInSearch:!0,customRender:({record:e})=>e.type===1&&(e.keepAlive?"是":"否")},{title:"是否显示",dataIndex:"show",width:80,hideInSearch:!0,customRender:({record:e})=>{const n=~~e.show===1,p=n?"green":"red",a=n?"显示":"隐藏";return r(h,{color:p},A(a)?a:{default:()=>[a]})}},{title:"状态",dataIndex:"status",width:80,hideInSearch:!0,customRender:({record:e})=>{const n=~~e.status===1,p=n?"green":"red",a=n?"启用":"停用";return r(h,{color:p},A(a)?a:{default:()=>[a]})}},{title:"更新时间",width:180,dataIndex:"updatedAt",hideInSearch:!0,customRender({text:e}){return se(e)}}],ye=e=>e===0,j=e=>e===1,f=e=>e===2,he=()=>[{field:"type",component:"RadioGroup",label:"菜单类型",defaultValue:0,rules:[{required:!0,type:"number"}],componentProps:{options:[{label:"目录",value:0},{label:"菜单",value:1},{label:"权限",value:2}]}},{field:"name",component:"Input",label:({formModel:e})=>f(e.type)?"权限名称":"节点名称",rules:[{required:!0,type:"string"}]},{field:"parentId",component:"TreeSelect",label:"上级节点",componentProps:{fieldNames:{label:"name",value:"id"},request:async({schema:e,formModel:l})=>{const n=await b.systemMenu.menuList({}),p=[-1].concat(re(n,l.parentId)||[]);return e.value.componentProps.treeDefaultExpandedKeys=p,[{id:-1,name:"根目录",children:n}]},getPopupContainer:()=>document.body},rules:[{required:!0,type:"number"}]},{field:"path",component:"Input",label:"路由地址",vIf:({formModel:e})=>!f(e.type),rules:[{required:!0,type:"string"}]},{field:"permission",component:"Input",label:"权限",helpMessage:"对应控制器中定义的权限字符，如：@Perm('system:menu:list'))",vIf:({formModel:e})=>!ye(e.type),required:({formModel:e})=>f(e.type),afterSlot:({schema:e,formInstance:l,formModel:n})=>e.value.component==="Input"?R(P,{icon:"ant-design:folder-open-outlined",title:"选择权限",class:"ml-[12px] cursor-pointer",onclick:async()=>{const p=await b.systemMenu.menuGetPermissions();typeof n.permission=="string"&&(n.permission=n.permission.split(":")),l.updateSchema({field:"permission",component:"Cascader",componentProps:{displayRender:({labels:a})=>a.join(":"),options:p.reduce((a,m)=>($(m,a,":"),a),[])}})}}):R(P,{icon:"ant-design:edit-outlined",title:"手动输入",class:"ml-[12px] cursor-pointer",onclick:()=>{Array.isArray(n.permission)&&(n.permission=n.permission.join(":")),l.updateSchema({field:"permission",component:"Input"})}})},{field:"component",component:"Cascader",label:"文件路径",vIf:({formModel:e})=>j(e.type)&&!e.isExt,componentProps:{options:Object.keys(ee).reduce((e,l)=>($(l,e,"/"),e),[])},rules:[{required:!0,type:"array"}]},{field:"icon",component:()=>me,label:"节点图标",vIf:({formModel:e})=>!f(e.type)},{field:"orderNo",component:"InputNumber",label:"排序号",defaultValue:255,componentProps:{style:{width:"100%"}}},{field:"isExt",component:"RadioGroup",label:"是否外链",defaultValue:!1,helpMessage:"选择是外链则路由地址需要以`http(s)://`开头",colProps:{span:12},componentProps:{optionType:"button",buttonStyle:"solid",options:[{label:"是",value:!0},{label:"否",value:!1}]},vIf:({formModel:e})=>!f(e.type)},{field:"extOpenMode",component:"RadioGroup",label:"打开方式",defaultValue:1,vIf:({formModel:e})=>!f(e.type)&&e.isExt,colProps:{span:12},componentProps:{optionType:"button",buttonStyle:"solid",options:[{label:"新窗口打开",value:1},{label:"内嵌页打开",value:2}]}},{field:"keepAlive",component:"RadioGroup",label:"是否缓存",defaultValue:0,vIf:({formModel:e})=>j(e.type),colProps:{span:12},componentProps:{optionType:"button",buttonStyle:"solid",options:[{label:"是",value:1},{label:"否",value:0}]}},{field:"show",component:"RadioGroup",label:"是否显示",defaultValue:1,colProps:{span:12},helpMessage:"会生成路由,但左侧菜单不可见",componentProps:{optionType:"button",buttonStyle:"solid",options:[{label:"是",value:1},{label:"否",value:0}]},vIf:({formModel:e})=>!f(e.type)},{field:"activeMenu",component:"Input",label:"高亮菜单项",colProps:{span:12},helpMessage:"值为某个的节点的路由地址(可设置当前路由高亮的菜单项，多用于详情页)",componentProps:{placeholder:"需要高亮的菜单项(节点名称)"},vIf:({formModel:e})=>!e.show&&!f(e.type)},{field:"status",label:"状态",component:"RadioGroup",defaultValue:1,helpMessage:"不会生成路由,同时左侧菜单不可见",componentProps:{optionType:"button",buttonStyle:"solid",options:[{label:"启用",value:1},{label:"禁用",value:0}]}}],ve={class:"flex gap-2 ml-2"},ct=V({name:"SysMenu",__name:"index",setup(e){const[l,n]=pe({pagination:!1,size:"small",rowKey:"id",bordered:!0,autoHeight:!0}),[p]=ue(),a=ae();te(document.documentElement,()=>{var t;const o=(t=a==null?void 0:a.proxy)==null?void 0:t.$el;o&&n.setProps({scroll:{x:window.innerWidth>2e3?o.offsetWidth-20:2e3}})});const m=async o=>{var s;const[t]=await p({modalProps:{title:`${o.id?"编辑":"新增"}菜单`,width:700,onFinish:async i=>{o.id&&(i.menuId=o.id),Array.isArray(i.component)&&(i.component=i.component.join("/")),Array.isArray(i.permission)&&(i.permission=i.permission.join(":")),i.parentId===-1&&Reflect.deleteProperty(i,"parentId"),o.id?await b.systemMenu.menuUpdate({id:o.id},i):await b.systemMenu.menuCreate(i),n.reload()}},formProps:{labelWidth:100,schemas:he()}});t==null||t.setFieldsValue({...o,icon:o.icon??"",parentId:o.parentId??-1,component:(s=o.component)==null?void 0:s.split("/")})},I=async o=>{await b.systemMenu.menuDelete({id:o.id}),n.reload()},x=[...be,{title:"操作",width:160,dataIndex:"ACTION",hideInSearch:!0,fixed:"right",actions:({record:o})=>[{label:"编辑",auth:{perm:"system:menu:update",effect:"disable"},onClick:()=>m(o)},{label:"新增",auth:{perm:"system:menu:create",effect:"disable"},disabled:o.type===2||o.status===0,onClick:()=>m({parentId:o.id})},{label:"删除",auth:"system:menu:delete",popConfirm:{title:"你确定要删除吗？",placement:"left",onConfirm:()=>I(o)}}]}];return(o,t)=>{const s=ne("a-button");return v(),k(d(l),{"header-title":"菜单管理","data-request":d(b).systemMenu.menuList,columns:x},{afterHeaderTitle:c(()=>[oe("div",ve,[r(s,{onClick:d(n).expandAll},{default:c(()=>t[1]||(t[1]=[y("展开全部")])),_:1},8,["onClick"]),r(s,{onClick:d(n).collapseAll},{default:c(()=>t[2]||(t[2]=[y("折叠全部")])),_:1},8,["onClick"])])]),toolbar:c(()=>[r(s,{type:"primary",disabled:!o.$auth("system:menu:create"),onClick:t[0]||(t[0]=i=>m({}))},{default:c(()=>t[3]||(t[3]=[y(" 新增 ")])),_:1},8,["disabled"])]),_:1},8,["data-request"])}}});export{ct as default};
