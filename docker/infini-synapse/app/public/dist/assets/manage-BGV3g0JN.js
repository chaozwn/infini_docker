import{r as k,e as R,aB as D,c as a,aC as H,A as ne,d as G,F as m,aD as ae,K as q,aE as le,aF as oe,aG as se,w as ie,o as re,q as I,B,E as h,G as V,v as N,Q as ue,aH as me,H as z,y as ce,as as O,ak as pe}from"./index-CP_NLk5V.js";import{_ as de,g as fe}from"./file-operate-button-list.vue_vue_type_script_setup_true_lang-BtkqueOu.js";import{_ as ve}from"./file-preview-drawer.vue_vue_type_script_setup_true_lang-VLSuSzHN.js";import{f as ye,i as he,p as ge}from"./index-DGspTBaA.js";import{f as be}from"./dateUtil-CsedNW7R.js";import"./index.vue_vue_type_style_index_0_lang-NurQ_twy.js";import{u as ke}from"./useFormModal-dR7fjBbO.js";import{M as S}from"./index-ui2LYhtl.js";import{D as _e}from"./index-D71WF9tc.js";import{u as Ce}from"./dynamic-table-JSGoDHP1.js";import"./ApiSelect.vue_vue_type_script_setup_true_lang-rDwSI5B1.js";import{S as U}from"./index-D-YWnkJu.js";import{F as we}from"./index-C8mpr5is.js";import{B as j}from"./index-jZxhvwdx.js";import"./index-DkkXTBW6.js";import{T as K}from"./Text-BJ9iz6Il.js";import{C as De}from"./index-DZgwoUJC.js";import"./file-upload-drawer.vue_vue_type_script_setup_true_lang-BT_4Uhb1.js";import"./index-BalfchpH.js";import"./index-B9_A_Raz.js";import"./cloneDeep-Be4MLehs.js";import"./useFlexGapSupport-C1UkMKsL.js";import"./useRefs-Dv5vkZVi.js";import"./_arrayIncludesWith-DbV0gfeD.js";import"./debounce-Yn7_oL9X.js";import"./QuestionCircleOutlined-DrJxdn7s.js";import"./collapseMotion-IEGzNviF.js";import"./_castArrayLikeObject-ILv2M5FZ.js";import"./index-CkcvDGSF.js";import"./CheckOutlined-Cdt44iMS.js";import"./useMergedState-Df90kDYb.js";import"./index-BqGUMiOM.js";import"./isNumeric-DjvBa-1E.js";import"./CopyOutlined-CKDHFiKQ.js";import"./index-9CKa-uza.js";import"./isNumber-Dd3hUNF9.js";import"./LeftOutlined-BDcNQYUt.js";import"./RightOutlined-b1GVfhJ5.js";import"./index-BA0eo9kg.js";import"./_baseUniq-CFFQq6dw.js";import"./FullscreenOutlined-EljRxNfp.js";import"./move-DnuFh34z.js";import"./index-D_-O6rwg.js";import"./index-qSWTwERE.js";import"./isMobile-BbN7I0i_.js";import"./DownOutlined-CFbTkQpD.js";import"./VerticalRightOutlined-De0bo4mZ.js";import"./index-BbOUjhHY.js";import"./index-bem_Mg93.js";import"./index-BV8c2Nm-.js";import"./pick-B4-lyv4c.js";import"./FileOutlined-BhArWp4e.js";import"./zh_CN-CAyhejr6.js";import"./EnterOutlined-CX4WQ0WC.js";import"./index-BRUJWZGa.js";import"./PlusOutlined-D-03OQz2.js";const Te=n=>n?ye(n):"-",Ie=()=>{const n=k([]),s=k(""),C=R(()=>!D(s.value)),d=R(()=>[{title:"文件名",dataIndex:"name",align:"left"},{title:"大小",width:120,align:"center",dataIndex:"fsize",customRender:({record:t})=>a("span",null,[Te(t.fsize)])},{title:"上传时间",dataIndex:"putTime",align:"center",width:220,customRender({text:t}){return t?be(t):"-"}},{title:"所属目录",dataIndex:"belongTo",align:"center",width:220,hideInTable:!C.value,customRender:({record:t})=>a(ne("a-button"),{type:"link",disabled:t.type==="file"&&H("netdisk:manage:info"),onClick:()=>g(t)},{default:()=>[t.belongTo?t.belongTo:"根目录"]})}]),g=t=>{s.value="",D(t.belongTo)?n.value=[]:n.value=t.belongTo.split("/")};return{columns:d,currentPathList:n,localSearchKey:s,isSearching:C}};function Me(n){return typeof n=="function"||Object.prototype.toString.call(n)==="[object Object]"&&!ae(n)}const Le={width:{type:Number,default:156},customEvent:{type:Object,default:null},styles:{type:Object},showIcon:{type:Boolean,default:!0},axis:{type:Object,default(){return{x:0,y:0}}},items:{type:Array,default(){return[]}}},W=n=>{const{item:s}=n;return a("span",{style:"display: inline-block; width: 100%; ",class:"px-4",onClick:n.handler.bind(null,s)},[n.showIcon&&s.icon&&a(le,{class:"mr-2",type:s.icon},null),a("span",null,[s.label])])},xe=G({name:"ContextMenu",props:Le,setup(n,{expose:s}){const C=k(!0),d=R(()=>{const{axis:u,items:i,styles:o,width:r}=n,{x:p,y:b}=u||{x:0,y:0},w=(i||[]).length*40,f=r,T=document.body,L=T.clientWidth<p+f?p-f:p,E=T.clientHeight<b+w?b-w:b;return{position:"absolute",width:`${r}px`,left:`${L+1}px`,top:`${E+1}px`,...o}}),g=()=>{C.value=!1};function t(u,i){const{handler:o,disabled:r}=u;r||(i==null||i.stopPropagation(),i==null||i.preventDefault(),o==null||o(),g())}function c(u){return u.filter(o=>!o.hidden).map(o=>{const{disabled:r,label:p,children:b,divider:w=!1}=o,f={item:o,handler:t,showIcon:n.showIcon};return!b||b.length===0?a(q,null,[a(S.Item,{disabled:r,key:p},{default:()=>[a(W,f,null)]}),w?a(S.Divider,{key:`d-${p}`},null):null]):a(S.SubMenu,{key:p,disabled:r},{title:()=>a(W,f,null),default:()=>c(b)})})}return s({close:g}),()=>{const{items:u}=n;return a(_e,{open:C.value},{default:()=>a("div",{style:m(d)},null),overlay:()=>{let i;return a(S,{inlineIndent:12,mode:"vertical"},Me(i=c(u))?i:{default:()=>[i]})}})}}}),$={domList:[],resolve:()=>{}},Se=function(n){const{event:s}=n;if(s&&(s==null||s.preventDefault()),!!he)return new Promise(C=>{const d=document.body,g=document.createElement("div"),t={getPopupContainer:()=>g};n.styles&&(t.styles=n.styles),n.items&&(t.items=n.items),n.event&&(t.customEvent=s,t.axis={x:s.clientX,y:s.clientY});const c=a(xe,t);oe(c,g);const u=function(){$.resolve("")};$.domList.push(g);const i=function(){$.domList.forEach(o=>{try{o&&d.removeChild(o)}catch(r){console.error(r)}}),d.removeEventListener("click",u),d.removeEventListener("scroll",u)};$.resolve=function(o){var r,p;(p=(r=c.component)==null?void 0:r.exposed)==null||p.close(),i(),C(o)},i(),d.appendChild(g),d.addEventListener("click",u),d.addEventListener("scroll",u)})},$e=["innerHTML"],Re={key:1},Ft=G({name:"NetDiskManage",__name:"manage",setup(n){const[s,C]=Ce(),[d]=ke(),{columns:g,currentPathList:t,localSearchKey:c,isSearching:u}=Ie(),i=k(),o=k([]),r=k(""),p=k(!1),b=k(!1),w=k(!1),f=k(!1),T=k([]),L=se({selectedRowKeys:[],onChange:(e,l)=>{L.selectedRowKeys=e,T.value=l.map(_=>({type:_.type,name:_.name}))}}),E=R(()=>D(r.value)),M=()=>{let e="";return t.value.length>0&&(e=`${t.value.join("/")}/`),e},J=(e,l)=>l==="dir"?"file-type-dir":ge(e),Q=e=>e.replace(new RegExp(`${c.value}`,"g"),`<span style='color: red;'>${c.value}</span>`),X=e=>{p.value!==e&&(p.value=e)},P=()=>{r.value=" ",o.value=[],T.value=[],f.value&&(f.value=!1),F()},F=async()=>{var _;if(f.value,f.value)return;b.value=!0,f.value=!0;const e=M(),l=await O.netDiskManage.netDiskManageList({path:e,key:c.value,marker:((_=r.value)==null?void 0:_.trim())||""}).finally(()=>b.value=!1);if(D(r))o.value=l.list||[];else{const v=l.list.filter(y=>y.type==="file"?!0:!o.value.find(x=>x.type==="file"?!1:x.name===y.name));D(v)||o.value.push(...v)}r.value=l.marker,f.value=!1},A=e=>{u.value||(e===-1&&t.value.length>0?t.value=[]:e>=0&&t.value.length-1!==e&&(t.value=t.value.slice(0,e+1)))},Y=e=>{var l,_;if(e.type==="dir")if(u.value){const v=D(e.belongTo)?[]:e.belongTo.split("/");v.push(e.name),c.value="",t.value=v}else t.value.push(e.name);else u.value?(l=i.value)==null||l.open(e.name,D(e.belongTo)?"":`${e.belongTo}/`):(_=i.value)==null||_.open(e.name,M())},Z=async e=>{try{w.value=!0;const l=await O.netDiskManage.netDiskManageDownload({path:M(),name:e.name});window.open(`${l}?attname=${encodeURIComponent(e.name)}`)}finally{w.value=!1}},ee=async e=>{await d({modalProps:{title:"重命名",width:700,onFinish:async l=>{await O.netDiskManage.netDiskManageRename({type:e.type,toName:l.toName,name:e.name,path:M()},{successMsg:"修改成功"}),P()}},formProps:{labelWidth:100,schemas:fe(e)}})},te=e=>({onContextmenu:l=>{Se({event:l,items:[{label:"下载",disabled:e.type==="dir"||!H("netdisk:manage:download"),handler:()=>{Z(e)}},{label:"重命名",disabled:!H("netdisk:manage:rename"),handler:()=>{ee(e)}}]})}});return ie([t,c],()=>{P()},{deep:!0}),re(()=>{F(),C.onInfiniteScroll(()=>{E.value||F()})}),(e,l)=>{const _=pe;return I(),B(m(De),{class:"h-full"},{title:h(()=>[a(m(U),null,{default:h(()=>[a(m(we)),a(m(j),null,{default:h(()=>[a(m(j).Item,null,{default:h(()=>[a(m(K).Link,{onClick:l[0]||(l[0]=v=>A(-1))},{default:h(()=>l[2]||(l[2]=[V("根目录")])),_:1})]),_:1}),(I(!0),N(q,null,ue(m(t),(v,y)=>(I(),B(m(j).Item,{key:y},{default:h(()=>[a(m(K).Link,{onClick:x=>A(y)},{default:h(()=>[V(z(v),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]),_:1})]),extra:h(()=>[a(de,{"search-key":m(c),"onUpdate:searchKey":l[1]||(l[1]=v=>me(c)?c.value=v:null),"selected-file-list":T.value,"update-operate-status":X,"parse-path":M,onChanged:P},null,8,["search-key","selected-file-list"])]),default:h(()=>[a(m(s),{"data-source":o.value,columns:m(g),"custom-row":te,"auto-height":!0,pagination:!1,search:!1,"show-tool-bar":!1,loading:b.value,"row-selection":L},{bodyCell:h(({column:v,record:y})=>[v.key==="name"?(I(),B(m(K).Link,{key:0,disabled:y.type==="file"&&e.$auth("netdisk:manage:info"),onClick:x=>Y(y)},{default:h(()=>[a(m(U),null,{default:h(()=>[a(_,{name:J(y.name,y.type)},null,8,["name"]),m(u)?(I(),N("span",{key:0,innerHTML:Q(y.name)},null,8,$e)):(I(),N("span",Re,z(y.name),1))]),_:2},1024)]),_:2},1032,["disabled","onClick"])):ce("",!0)]),_:1},8,["data-source","columns","loading","row-selection"]),a(ve,{ref_key:"previewDrawerRef",ref:i},null,512)]),_:1})}}});export{Ft as default};
