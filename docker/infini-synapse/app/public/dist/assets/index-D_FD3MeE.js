import{T as u}from"./index-DJ9VtLIp.js";import{c as o,K as f,aB as y,as as s,d as g,bP as b,G as h}from"./index-D73brYWd.js";import"./index.vue_vue_type_style_index_0_lang-jPG9mWAr.js";import{u as _}from"./useFormModal-CvxAK1MS.js";import{u as q}from"./dynamic-table-rCuI28Ch.js";import"./ApiSelect.vue_vue_type_script_setup_true_lang-CTkiIV23.js";import"./dateUtil-CYZqroMz.js";import"./index-C0JiSkxO.js";import"./useFlexGapSupport-DpW12j3I.js";import"./debounce-qJAVO1WR.js";import"./index-B88scmTj.js";import"./index-BxSM-tU1.js";import"./_baseUniq-DcgT1zl-.js";import"./_arrayIncludesWith-DbV0gfeD.js";import"./collapseMotion-3w0S54yK.js";import"./move-CfhobaxH.js";import"./RightOutlined-B9R09Uny.js";import"./index-CwOAEvEt.js";import"./index-D1ak3k5w.js";import"./isMobile-BbN7I0i_.js";import"./useMergedState-BDNnAAhH.js";import"./DownOutlined-MwNv9Jnp.js";import"./CheckOutlined-WSbuErYm.js";import"./VerticalRightOutlined-x1sKNTDu.js";import"./cloneDeep-DJxAzrwk.js";import"./index-BgjqQW_m.js";import"./index-BM45GRHT.js";import"./_castArrayLikeObject-BBqJmE3s.js";import"./index-Dm8puzL-.js";import"./LeftOutlined-CYdjhgLQ.js";import"./zh_CN-CAyhejr6.js";import"./index-B-ffqr6C.js";import"./FileOutlined-BPwFBDFY.js";import"./Text-D3oBRJp3.js";import"./EnterOutlined-BtJxXTqD.js";import"./CopyOutlined-BkygObFl.js";import"./index-BkGqywJR.js";import"./useRefs-CWtriciZ.js";import"./QuestionCircleOutlined-Dz9ixMBS.js";import"./isNumber-DTK1AmC1.js";import"./index-EgiEKr-t.js";import"./index-BOd3Ao87.js";import"./pick-C_CvEy9q.js";function I(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!y(e)}const P=[{title:"连接名(AI使用关键字)",width:80,key:"search_name",formItemProps:{labelWidth:120,colProps:{span:6}},dataIndex:"name"},{title:"Description(用于AI识别数据源)",dataIndex:"description",hideInSearch:!0,width:150},{title:"Relative Rags",dataIndex:"rag_names",hideInSearch:!0,width:150,customRender:({record:e})=>{var l,m,p;return o("div",{class:"flex gap-2 items-center flex-wrap"},[(l=e.rag_names)!=null&&l.length&&((m=e.rag_names)==null?void 0:m.length)>0?(p=e.rag_names)==null?void 0:p.map(n=>o(u,{color:"blue"},I(n)?n:{default:()=>[n]})):o(f,null,null)])}},{title:"Database Type",dataIndex:"type",key:"search_type",formItemProps:{component:"Select",componentProps:{placeholder:"",options:[{label:"Mysql",value:"mysql"}]},labelWidth:120,colProps:{span:6}},width:80},{title:"Enabled",dataIndex:"enabled",width:80,key:"search_enabled",formItemProps:{labelWidth:80,colProps:{span:4},component:"Select",componentProps:{options:[{label:"enabled",value:1},{label:"disabled",value:0}]}},customRender:({record:e})=>o(u,{color:e.enabled?"green":"red"},{default:()=>[e.enabled?"enabled":"disabled"]})}],v=()=>s.ai.getAllRags().then(e=>e.map(l=>({label:l.name,value:l.name}))),w=[{field:"file_system",component:"Select",componentProps:{placeholder:"",options:[{label:"File",value:"file"}]},rules:[{required:!0,type:"string",message:"文件系统不能为空"}],label:"文件系统",helpMessage:"目前仅支持本地文件系统, 未来会支持OSS等云存储",vIf:e=>e.values.type==="file"},{field:"file_type",component:"Select",componentProps:{placeholder:"",options:[{label:"Csv",value:"csv"},{label:"Excel",value:"excel"},{label:"Json",value:"json"},{label:"Parquet",value:"parquet"},{label:"Orc",value:"orc"}]},rules:[{required:!0,type:"string",message:"数据库类型不能为空"}],label:"文件类型",vIf:e=>e.values.type==="file"},{field:"file_path",component:"Input",label:"文件地址",componentProps:{placeholder:""},rules:[{required:!0,type:"string",message:"File Path不能为空"}],vIf:e=>e.values.type==="file"},{field:"file_sheet_name",component:"Input",label:"Sheet名称(不填默认为第一个Sheet)",componentProps:{placeholder:""},vIf:e=>e.values.type==="file"&&e.values.file_type==="excel"}],S=[{field:"mysql_host",component:"Input",label:"主机地址",componentProps:{placeholder:""},rules:[{required:!0,type:"string",message:"host不能为空"}],vIf:e=>e.values.type==="mysql"},{field:"mysql_port",component:"InputNumber",label:"端口",componentProps:{placeholder:""},vIf:e=>e.values.type==="mysql",rules:[{required:!0,type:"number",message:"port不能为空"}]},{field:"mysql_username",component:"Input",componentProps:{placeholder:""},label:"用户名",vIf:e=>e.values.type==="mysql",rules:[{required:!0,type:"string",message:"用户名不能为空"}]},{field:"mysql_password",component:"Input",componentProps:{placeholder:"",type:"password"},label:"密码",rules:[{required:!0,type:"string",message:"密码不能为空"}],vIf:e=>e.values.type==="mysql"},{field:"mysql_database",component:"Input",componentProps:{placeholder:""},label:"数据库",rules:[{required:!0,type:"string",message:"数据库不能为空"}],vIf:e=>e.values.type==="mysql"}],x=[{field:"pg_host",component:"Input",label:"主机地址",componentProps:{placeholder:""},rules:[{required:!0,type:"string",message:"host不能为空"}],vIf:e=>e.values.type==="postgres"},{field:"pg_port",component:"InputNumber",label:"端口",componentProps:{placeholder:""},vIf:e=>e.values.type==="postgres",rules:[{required:!0,type:"number",message:"port不能为空"}]},{field:"pg_username",component:"Input",componentProps:{placeholder:""},label:"用户名",vIf:e=>e.values.type==="postgres",rules:[{required:!0,type:"string",message:"用户名不能为空"}]},{field:"pg_password",component:"Input",componentProps:{placeholder:"",type:"password"},label:"密码",rules:[{required:!0,type:"string",message:"密码不能为空"}],vIf:e=>e.values.type==="postgres"},{field:"pg_database",component:"Input",componentProps:{placeholder:""},label:"数据库",rules:[{required:!0,type:"string",message:"数据库不能为空"}],vIf:e=>e.values.type==="postgres"},{field:"pg_schema",component:"Input",componentProps:{placeholder:""},label:"Schema",vIf:e=>e.values.type==="postgres",rules:[{required:!0,type:"string",message:"Schema不能为空"}]}],A=[{field:"name",component:"Input",componentProps:{placeholder:""},label:"连接名称",rules:[{required:!0,type:"string",message:"请输入连接名称"},{pattern:/^[a-zA-Z0-9_]+$/,message:"名称只能包含字母、数字和下划线"}]},{field:"description",component:"InputTextArea",label:"Database描述",helpMessage:"Database的描述,将会在Agent的prompt中使用，可以提高模型判断使用数据库的准确性",componentProps:{placeholder:"",rows:2},defaultValue:"",rules:[{required:!0,type:"string",message:"请输入RAG的功能描述"}]},{field:"rag_names",component:"Select",componentProps:()=>({mode:"multiple",defaultActiveFirstOption:!1,optionLabelProp:"value",request:()=>v(),placeholder:""}),label:"关联RAG"},{field:"type",component:"Select",componentProps:{placeholder:"",options:[{label:"Mysql",value:"mysql"},{label:"Postgres",value:"postgres"},{label:"File",value:"file"}]},rules:[{required:!0,type:"string",message:"数据库类型不能为空"}],label:"数据库类型"},{field:"enabled",component:"Switch",label:"是否启用"},...S,...x,...w],be=g({setup:()=>{const[e,l]=q(),[m]=_(),p=async r=>{const[i]=await m({modalProps:{title:`${r.id?"编辑":"新增"}`,width:"50%",onFinish:async t=>{let a={};switch(t.type){case"mysql":a={mysql_host:t.mysql_host,mysql_port:t.mysql_port,mysql_username:t.mysql_username,mysql_password:t.mysql_password,mysql_database:t.mysql_database};break;case"postgres":a={pg_host:t.pg_host,pg_port:t.pg_port,pg_username:t.pg_username,pg_password:t.pg_password,pg_database:t.pg_database,pg_schema:t.pg_schema};break;case"file":a={file_type:t.file_type,file_system:t.file_system,file_path:t.file_path,file_sheet_name:t.file_sheet_name};break}if(r.id){let d={...t,id:r.id,enabled:t.enabled?1:0,config:JSON.stringify(a)};await s.ai.updateDatabase(d)}else await s.ai.addDatabase({...t,enabled:t.enabled?1:0,config:JSON.stringify(a)});l==null||l.reload()}},formProps:{layout:"vertical",schemas:A}});i==null||i.setFieldsValue({...r,enabled:r.enabled===1})},n=async r=>{await s.ai.deleteDatabase(r),l==null||l.reload()},c=[...P,{title:"操作",width:130,dataIndex:"ACTION",hideInSearch:!0,fixed:"right",actions:({record:r})=>[{label:"Edit",onClick:async()=>{const i=await s.ai.getDatabaseById(r.id),{config:t,...a}=i,d=JSON.parse(t);p({...a,...d})}},{label:"Delete",danger:!0,popConfirm:{title:"Are you sure you want to delete this model?",placement:"left",onConfirm:()=>{r.id&&n(r.id)}}}]}];return()=>o("div",{class:"w-full h-full overflow-scroll container px-4 py-5"},[o(e,{rowKey:"id",headerTitle:"Database List",columns:c,bordered:!0,size:"small",dataRequest:s.ai.listDatabases},{toolbar:()=>o(b,{type:"primary",onClick:()=>p({enabled:1})},{default:()=>[h("Add")]})})])}});export{be as default};
