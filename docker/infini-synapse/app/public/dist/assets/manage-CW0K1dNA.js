import{r as k,b as R,ax as D,c as a,ay as A,A as ne,d as q,F as c,az as ae,J,aA as le,aB as oe,aC as se,w as ie,o as re,n as I,B,E as h,x as H,q as F,N as ue,aD as ce,G as V,y as me,aq as O,ai as pe}from"./index-DfFq98iI.js";import{_ as de,g as fe}from"./file-operate-button-list.vue_vue_type_script_setup_true_lang-G6SHkCtX.js";import{_ as ve}from"./file-preview-drawer.vue_vue_type_script_setup_true_lang-CWVt5mvE.js";import{f as ye,i as he,p as ge}from"./index-DKBsGozE.js";import{f as be}from"./dateUtil-Yht9XRPF.js";import"./index.vue_vue_type_style_index_0_lang-BfNlMPF9.js";import{u as ke}from"./useFormModal-BxahiGiP.js";import{M as S}from"./index-C7momlVE.js";import{D as _e}from"./index-BLXV14Bz.js";import{u as Ce}from"./dynamic-table-BvYG2uaQ.js";import"./ApiSelect.vue_vue_type_script_setup_true_lang-DfpO8rn_.js";import{S as U}from"./index-LC6BztS_.js";import{F as we}from"./index-hVU4LEoT.js";import{B as j}from"./index-B_l9r8Ja.js";import"./index-BBU6WuBs.js";import{T as K}from"./Text-DvgTWTh8.js";import{C as De}from"./index-DURW8ZuM.js";import"./file-upload-drawer.vue_vue_type_script_setup_true_lang-DB8wBq3C.js";import"./index-Cd8zMccQ.js";import"./index-DgRcuS_8.js";import"./cloneDeep-7HLhhoFu.js";import"./useFlexGapSupport-CQZF-aUP.js";import"./useRefs-DiW-EIw3.js";import"./_arrayIncludesWith-DbV0gfeD.js";import"./debounce-Df4UesAS.js";import"./QuestionCircleOutlined-ssBuu4EU.js";import"./collapseMotion-Cr6AhTec.js";import"./_castArrayLikeObject-BrPOkB4F.js";import"./CheckOutlined-Cf9d_uMY.js";import"./useMergedState-DSTrXYcS.js";import"./index-L0-0LCSs.js";import"./CopyOutlined-5vJVwE4n.js";import"./isNumber-Bv4T1dtx.js";import"./LeftOutlined-BjLfI7Ei.js";import"./RightOutlined-BZ2pGhZt.js";import"./index-nxZqHvnr.js";import"./_baseUniq-Ye7AfUyy.js";import"./move-DkkIAjWs.js";import"./index-B8_A7MkL.js";import"./index-BqNSHfyN.js";import"./isMobile-BbN7I0i_.js";import"./DownOutlined-8VBGnHmu.js";import"./VerticalRightOutlined-BIMOJVTh.js";import"./index-DlL-KCqt.js";import"./index-D9hduaB1.js";import"./index-Dlnok0kj.js";import"./pick-CFxAzuma.js";import"./FileOutlined-oE-j5Vil.js";import"./zh_CN-CAyhejr6.js";import"./EnterOutlined-_30rq_Kv.js";import"./index-Bcu5QuUv.js";import"./PlusOutlined-BejYLDml.js";const Te=n=>n?ye(n):"-",Ie=()=>{const n=k([]),s=k(""),C=R(()=>!D(s.value)),d=R(()=>[{title:"文件名",dataIndex:"name",align:"left"},{title:"大小",width:120,align:"center",dataIndex:"fsize",customRender:({record:t})=>a("span",null,[Te(t.fsize)])},{title:"上传时间",dataIndex:"putTime",align:"center",width:220,customRender({text:t}){return t?be(t):"-"}},{title:"所属目录",dataIndex:"belongTo",align:"center",width:220,hideInTable:!C.value,customRender:({record:t})=>a(ne("a-button"),{type:"link",disabled:t.type==="file"&&A("netdisk:manage:info"),onClick:()=>g(t)},{default:()=>[t.belongTo?t.belongTo:"根目录"]})}]),g=t=>{s.value="",D(t.belongTo)?n.value=[]:n.value=t.belongTo.split("/")};return{columns:d,currentPathList:n,localSearchKey:s,isSearching:C}};function Me(n){return typeof n=="function"||Object.prototype.toString.call(n)==="[object Object]"&&!ae(n)}const xe={width:{type:Number,default:156},customEvent:{type:Object,default:null},styles:{type:Object},showIcon:{type:Boolean,default:!0},axis:{type:Object,default(){return{x:0,y:0}}},items:{type:Array,default(){return[]}}},W=n=>{const{item:s}=n;return a("span",{style:"display: inline-block; width: 100%; ",class:"px-4",onClick:n.handler.bind(null,s)},[n.showIcon&&s.icon&&a(le,{class:"mr-2",type:s.icon},null),a("span",null,[s.label])])},Le=q({name:"ContextMenu",props:xe,setup(n,{expose:s}){const C=k(!0),d=R(()=>{const{axis:u,items:i,styles:o,width:r}=n,{x:p,y:b}=u||{x:0,y:0},w=(i||[]).length*40,f=r,T=document.body,x=T.clientWidth<p+f?p-f:p,E=T.clientHeight<b+w?b-w:b;return{position:"absolute",width:`${r}px`,left:`${x+1}px`,top:`${E+1}px`,...o}}),g=()=>{C.value=!1};function t(u,i){const{handler:o,disabled:r}=u;r||(i==null||i.stopPropagation(),i==null||i.preventDefault(),o==null||o(),g())}function m(u){return u.filter(o=>!o.hidden).map(o=>{const{disabled:r,label:p,children:b,divider:w=!1}=o,f={item:o,handler:t,showIcon:n.showIcon};return!b||b.length===0?a(J,null,[a(S.Item,{disabled:r,key:p},{default:()=>[a(W,f,null)]}),w?a(S.Divider,{key:`d-${p}`},null):null]):a(S.SubMenu,{key:p,disabled:r},{title:()=>a(W,f,null),default:()=>m(b)})})}return s({close:g}),()=>{const{items:u}=n;return a(_e,{open:C.value},{default:()=>a("div",{style:c(d)},null),overlay:()=>{let i;return a(S,{inlineIndent:12,mode:"vertical"},Me(i=m(u))?i:{default:()=>[i]})}})}}}),$={domList:[],resolve:()=>{}},Se=function(n){const{event:s}=n;if(s&&(s==null||s.preventDefault()),!!he)return new Promise(C=>{const d=document.body,g=document.createElement("div"),t={getPopupContainer:()=>g};n.styles&&(t.styles=n.styles),n.items&&(t.items=n.items),n.event&&(t.customEvent=s,t.axis={x:s.clientX,y:s.clientY});const m=a(Le,t);oe(m,g);const u=function(){$.resolve("")};$.domList.push(g);const i=function(){$.domList.forEach(o=>{try{o&&d.removeChild(o)}catch(r){console.error(r)}}),d.removeEventListener("click",u),d.removeEventListener("scroll",u)};$.resolve=function(o){var r,p;(p=(r=m.component)==null?void 0:r.exposed)==null||p.close(),i(),C(o)},i(),d.appendChild(g),d.addEventListener("click",u),d.addEventListener("scroll",u)})},$e=["innerHTML"],Re={key:1},$t=q({name:"NetDiskManage",__name:"manage",setup(n){const[s,C]=Ce(),[d]=ke(),{columns:g,currentPathList:t,localSearchKey:m,isSearching:u}=Ie(),i=k(),o=k([]),r=k(""),p=k(!1),b=k(!1),w=k(!1),f=k(!1),T=k([]),x=se({selectedRowKeys:[],onChange:(e,l)=>{x.selectedRowKeys=e,T.value=l.map(_=>({type:_.type,name:_.name}))}}),E=R(()=>D(r.value)),M=()=>{let e="";return t.value.length>0&&(e=`${t.value.join("/")}/`),e},G=(e,l)=>l==="dir"?"file-type-dir":ge(e),X=e=>e.replace(new RegExp(`${m.value}`,"g"),`<span style='color: red;'>${m.value}</span>`),Y=e=>{p.value!==e&&(p.value=e)},P=()=>{r.value=" ",o.value=[],T.value=[],f.value&&(f.value=!1),N()},N=async()=>{var _;if(f.value,f.value)return;b.value=!0,f.value=!0;const e=M(),l=await O.netDiskManage.netDiskManageList({path:e,key:m.value,marker:((_=r.value)==null?void 0:_.trim())||""}).finally(()=>b.value=!1);if(D(r))o.value=l.list||[];else{const v=l.list.filter(y=>y.type==="file"?!0:!o.value.find(L=>L.type==="file"?!1:L.name===y.name));D(v)||o.value.push(...v)}r.value=l.marker,f.value=!1},z=e=>{u.value||(e===-1&&t.value.length>0?t.value=[]:e>=0&&t.value.length-1!==e&&(t.value=t.value.slice(0,e+1)))},Q=e=>{var l,_;if(e.type==="dir")if(u.value){const v=D(e.belongTo)?[]:e.belongTo.split("/");v.push(e.name),m.value="",t.value=v}else t.value.push(e.name);else u.value?(l=i.value)==null||l.open(e.name,D(e.belongTo)?"":`${e.belongTo}/`):(_=i.value)==null||_.open(e.name,M())},Z=async e=>{try{w.value=!0;const l=await O.netDiskManage.netDiskManageDownload({path:M(),name:e.name});window.open(`${l}?attname=${encodeURIComponent(e.name)}`)}finally{w.value=!1}},ee=async e=>{await d({modalProps:{title:"重命名",width:700,onFinish:async l=>{await O.netDiskManage.netDiskManageRename({type:e.type,toName:l.toName,name:e.name,path:M()},{successMsg:"修改成功"}),P()}},formProps:{labelWidth:100,schemas:fe(e)}})},te=e=>({onContextmenu:l=>{Se({event:l,items:[{label:"下载",disabled:e.type==="dir"||!A("netdisk:manage:download"),handler:()=>{Z(e)}},{label:"重命名",disabled:!A("netdisk:manage:rename"),handler:()=>{ee(e)}}]})}});return ie([t,m],()=>{P()},{deep:!0}),re(()=>{N(),C.onInfiniteScroll(()=>{E.value||N()})}),(e,l)=>{const _=pe;return I(),B(c(De),{class:"h-full"},{title:h(()=>[a(c(U),null,{default:h(()=>[a(c(we)),a(c(j),null,{default:h(()=>[a(c(j).Item,null,{default:h(()=>[a(c(K).Link,{onClick:l[0]||(l[0]=v=>z(-1))},{default:h(()=>l[2]||(l[2]=[H("根目录")])),_:1})]),_:1}),(I(!0),F(J,null,ue(c(t),(v,y)=>(I(),B(c(j).Item,{key:y},{default:h(()=>[a(c(K).Link,{onClick:L=>z(y)},{default:h(()=>[H(V(v),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]),_:1})]),extra:h(()=>[a(de,{"search-key":c(m),"onUpdate:searchKey":l[1]||(l[1]=v=>ce(m)?m.value=v:null),"selected-file-list":T.value,"update-operate-status":Y,"parse-path":M,onChanged:P},null,8,["search-key","selected-file-list"])]),default:h(()=>[a(c(s),{"data-source":o.value,columns:c(g),"custom-row":te,"auto-height":!0,pagination:!1,search:!1,"show-tool-bar":!1,loading:b.value,"row-selection":x},{bodyCell:h(({column:v,record:y})=>[v.key==="name"?(I(),B(c(K).Link,{key:0,disabled:y.type==="file"&&e.$auth("netdisk:manage:info"),onClick:L=>Q(y)},{default:h(()=>[a(c(U),null,{default:h(()=>[a(_,{name:G(y.name,y.type)},null,8,["name"]),c(u)?(I(),F("span",{key:0,innerHTML:X(y.name)},null,8,$e)):(I(),F("span",Re,V(y.name),1))]),_:2},1024)]),_:2},1032,["disabled","onClick"])):me("",!0)]),_:1},8,["data-source","columns","loading","row-selection"]),a(ve,{ref_key:"previewDrawerRef",ref:i},null,512)]),_:1})}}});export{$t as default};
