import{d as F,r as v,b as d,F as w,cx as _,w as j,df as p,c as M,az as x,b6 as k,W as g,a1 as b,aB as R}from"./index-CcwBsoQ-.js";import{_ as S}from"./index.vue_vue_type_style_index_0_lang-NakS-CrT.js";import{_ as V}from"./ApiSelect.vue_vue_type_script_setup_true_lang-CPs_Q6Se.js";import"./dateUtil-CqRwQnap.js";function B(o){return typeof o=="function"||Object.prototype.toString.call(o)==="[object Object]"&&!x(o)}const O=F({props:{content:{type:[String,Function]},closeModal:Function,open:Boolean},setup(o,{attrs:l,expose:t}){const f=v(!1),u=v({...l,...o}),r=d(()=>({...l,...o,...w(u)})),h=d(()=>{const e=w(r);return{..._(e,["onCancel","onOk","closeModal","content"]),open:e.open,confirmLoading:f.value,onCancel:a,onOk:i}}),y=e=>{u.value.open=e},c=e=>{u.value={...w(r),...e}};j(()=>u.value.open,e=>{var n;Object.is(e,!1)&&((n=o.closeModal)==null||n.call(o))});const i=async e=>{var n,s;f.value=!0;try{await((s=(n=w(r))==null?void 0:n.onOk)==null?void 0:s.call(n,e)),y(!1)}catch(C){return Promise.reject(C)}finally{f.value=!1}},a=async e=>{var n,s;await((s=(n=w(r))==null?void 0:n.onCancel)==null?void 0:s.call(n,e)),y(!1)};return t({setProps:c}),()=>{const e=w(r),{content:n}=e,s=p(n)?n():n;return M(S,w(h),B(s)?s:{default:()=>[s]})}}}),I=()=>{var i;let o;const l=v(),t=(i=k())==null?void 0:i.appContext,f=v(!1),u=async()=>{if(await b(),f.value&&l.value)return l.value;if(o)return o;const a=document.createElement("div"),e=M(O);return e.appContext=t,R(e,a),o=e.component,o.props.closeModal=h,o},r=async a=>{var n,s,C;const e=await u();Object.is(e,l.value)?(n=e==null?void 0:e.setProps)==null||n.call(e,a):(C=(s=e==null?void 0:e.exposed)==null?void 0:s.setProps)==null||C.call(s,a)},h=()=>{r({open:!1})},y=async a=>{r({...a,closeModal:h,open:!0}),await b()},c=(a,{attrs:e,slots:n})=>(f.value=!0,M(O,g({ref:l},{...e,...a}),n));return c.show=y,c.hide=h,c.setProps=r,[c,l]};function z(){const[o]=I();return[async({modalProps:t,formProps:f})=>{const u=v(),r=c=>{var i;(i=t==null?void 0:t.onCancel)==null||i.call(t,c)},h=async()=>{var c,i;try{const a=await((c=u.value)==null?void 0:c.submit());await y(a)}catch(a){return(i=t==null?void 0:t.onFail)==null||i.call(t,{}),Promise.reject(a)}},y=async c=>{var i;await((i=t==null?void 0:t.onFinish)==null?void 0:i.call(t,c)),o.hide()};return await o.show({destroyOnClose:!0,..._(t,["onFinish","onFail"]),onCancel:r,onOk:h,content:()=>{const c=Object.assign({},{showActionButtonGroup:!1},f);return M(V,g({ref:u},c),null)}}),await b(),[w(u)]},o]}export{z as u};
