import{f as B}from"./index-DUIwCk99.js";import{d as T,q as u,v as I,r as l,e as V,B as f,E as s,c as r,F as a,Q as $,K as E,G as x,a3 as F,as as _,aC as H,M as N,A as P,aS as L,H as U,a9 as j}from"./index-BZdmBmj0.js";import{f as q}from"./dateUtil-B5XOsNoS.js";import{S}from"./index-DetSc4co.js";import{I as G}from"./index-D8Z71L0l.js";import{D as b}from"./index-6Nd3J7VP.js";import{D as K}from"./index-DuJmecm7.js";const Q=["data","type"],W=T({name:"preview-resource",__name:"index",props:{url:{type:String},type:{type:String}},setup(c){return(D,d)=>(u(),I("object",{key:c.url,data:c.url,type:c.type,width:"100%",height:"100%"},null,8,Q))}}),ae=T({name:"FilePreviewDrawer",__name:"file-preview-drawer",setup(c,{expose:D}){const d=new Map([["name","文件名"],["mimeType","文件类型"],["hash","文件Hash"],["md5","文件MD5"],["fsize","文件大小"],["putTime","上传时间"],["uploader","上传人员"]]),w=l(!1),g=l(!1),h=l(""),y=l(""),t=l({}),m=l(""),p=l(""),k=l(!1),C=V(()=>`${m.value}?imageView2/2/w/500/h/210`),z=async(o,n)=>{g.value=!0,h.value=o,y.value=n,await F();try{w.value=!0;const v={name:o,path:n},i=await _.netDiskManage.netDiskManageInfo(v);if(p.value=i.mark,Array.from(d.keys()).forEach(e=>{e==="fsize"?t.value.fsize=B(i[e]):t.value[e]=i[e]}),t.value.putTime=q(i.putTime),t.value.name=o,H("netdisk:manage:download")){const e=await _.netDiskManage.netDiskManageDownload(v);m.value=e}}catch{M()}finally{w.value=!1}},A=async()=>{try{k.value=!0,await _.netDiskManage.netDiskManageMark({name:h.value,path:y.value,mark:p.value}),N.success("已更新文件备注")}finally{k.value=!1}},M=()=>{h.value="",y.value="",m.value="",p.value="",t.value={},g.value=!1};return D({open:z}),(o,n)=>{const v=P("a-button");return u(),f(a(K),{title:"文件详情",width:500,visible:g.value,onClose:M},{default:s(()=>[r(a(L),{spinning:w.value,class:"preview-drawer-inner-box"},{default:s(()=>[r(a(S),{direction:"vertical"},{default:s(()=>{var i;return[(i=t.value.mimeType)!=null&&i.startsWith("image/")?(u(),f(a(G),{key:0,class:"w-full h-[210px]",src:C.value,preview:{src:m.value}},null,8,["src","preview"])):(u(),f(W,{key:1,class:"w-full h-[210px]",url:m.value,type:t.value.mimeType},null,8,["url","type"])),r(a(b),{bordered:"",column:1,size:"small"},{default:s(()=>[(u(!0),I(E,null,$(a(d).keys(),e=>(u(),f(a(b).Item,{key:e,label:a(d).get(e),"label-style":{whiteSpace:"nowrap"}},{default:s(()=>[x(U(t.value[e]),1)]),_:2},1032,["label"]))),128)),r(a(b).Item,{label:"文件备注","label-style":{whiteSpace:"nowrap"}},{default:s(()=>[r(a(S),{direction:"vertical",align:"end"},{default:s(()=>[r(a(j).TextArea,{value:p.value,"onUpdate:value":n[0]||(n[0]=e=>p.value=e),disabled:!o.$auth("netdisk:manage:mark"),placeholder:"请输入文件备注",maxlength:100,rows:4,"show-count":""},null,8,["value","disabled"]),r(v,{loading:k.value,disabled:!o.$auth("netdisk:manage:mark"),type:"primary",size:"mini",onClick:A},{default:s(()=>n[1]||(n[1]=[x("更新 ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]}),_:1})]),_:1},8,["spinning"])]),_:1},8,["visible"])}}});export{ae as _};
