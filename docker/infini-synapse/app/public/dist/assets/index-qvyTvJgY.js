import{T as d}from"./index-B3zoHzht.js";import{c as l,J as g,az as h,aq as p,d as c,r as f,o as y,bM as _,x as I}from"./index-xILFvC6p.js";import{C as q}from"./ApiSelect.vue_vue_type_script_setup_true_lang-BYJ7iGqz.js";import"./index.vue_vue_type_style_index_0_lang-jqXZEHoQ.js";import{u as v}from"./useFormModal-BBfJTTTp.js";import{u as P}from"./dynamic-table-BnI0ezut.js";import"./dateUtil-t9nO_S_a.js";import"./isNumber-DQjrxlJR.js";import"./index-CUELb_gB.js";import"./DownOutlined-CwGJM8Cx.js";import"./isMobile-BbN7I0i_.js";import"./index-BlCeSx5_.js";import"./index-huArR9Po.js";import"./_baseUniq-CN2PPb1A.js";import"./_arrayIncludesWith-DbV0gfeD.js";import"./collapseMotion-BTtFF6ah.js";import"./index-BQJ5s33I.js";import"./useMergedState-BZJDsHAZ.js";import"./CheckOutlined-0TDqkgWH.js";import"./move-BgR_7ULJ.js";import"./index-Cw9sezyn.js";import"./FileOutlined-BPIWEwF1.js";import"./debounce-CLt6A2Mw.js";import"./index-bLD_aexU.js";import"./RightOutlined-B8VFUM5r.js";import"./LeftOutlined-8oYowfNL.js";import"./index-CJBistm3.js";import"./cloneDeep-DOQCGcdx.js";import"./useFlexGapSupport-DZ8DfDQl.js";import"./useRefs-GYf3EJWi.js";import"./QuestionCircleOutlined-HpFoKfoF.js";import"./_castArrayLikeObject-tuUV6ov5.js";import"./index-DmTFvYe-.js";import"./index-BteXtNVv.js";import"./pick-DTmDJZmp.js";import"./index-LoumDwdv.js";import"./index-DjyhJka5.js";import"./VerticalRightOutlined-CulkF_C4.js";import"./index-BaDomnQE.js";import"./zh_CN-CAyhejr6.js";import"./Text-Cjl2khGI.js";import"./EnterOutlined-YDoaGkNm.js";import"./CopyOutlined-DHBrudLu.js";function w(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!h(e)}const k=[{title:"连接名(AI使用关键字)",width:80,key:"search_name",formItemProps:{labelWidth:120,colProps:{span:6}},dataIndex:"name"},{title:"Description(用于AI识别数据源)",dataIndex:"description",hideInSearch:!0,width:150},{title:"Relative Rags",dataIndex:"rag_names",hideInSearch:!0,width:150,customRender:({record:e})=>{var s,a,n;return l("div",{class:"flex gap-2 items-center flex-wrap"},[(s=e.rag_names)!=null&&s.length&&((a=e.rag_names)==null?void 0:a.length)>0?(n=e.rag_names)==null?void 0:n.map(i=>l(d,{color:"blue"},w(i)?i:{default:()=>[i]})):l(g,null,null)])}},{title:"Database Type",dataIndex:"type",key:"search_type",formItemProps:{component:"Select",componentProps:{placeholder:"",options:[{label:"Mysql",value:"mysql"}]},labelWidth:120,colProps:{span:6}},width:80},{title:"Enabled",dataIndex:"enabled",width:80,key:"search_enabled",formItemProps:{labelWidth:80,colProps:{span:4},component:"Select",componentProps:{options:[{label:"enabled",value:1},{label:"disabled",value:0}]}},customRender:({record:e})=>l(d,{color:e.enabled?"green":"red"},{default:()=>[e.enabled?"enabled":"disabled"]})}],S=()=>p.ai.getAllRags().then(e=>e.map(s=>({label:s.name,value:s.name}))),x=async()=>{const e=await p.toolsUpload.getFileTree();return e},z=[{field:"file_system",component:"Select",componentProps:{placeholder:"",options:[{label:"File",value:"file"}]},rules:[{required:!0,type:"string",message:"文件系统不能为空"}],label:"文件系统",helpMessage:"目前仅支持本地文件系统, 未来会支持OSS等云存储",vIf:e=>e.values.type==="file"},{field:"file_type",component:"Select",componentProps:{placeholder:"",options:[{label:"Csv",value:"csv"},{label:"Excel",value:"excel"},{label:"Json",value:"json"},{label:"Parquet",value:"parquet"},{label:"Orc",value:"orc"}]},rules:[{required:!0,type:"string",message:"数据库类型不能为空"}],label:"文件类型",vIf:e=>e.values.type==="file"},{field:"file_path",label:"文件路径",component:({formModel:e})=>c({setup:()=>{const s=f();return y(async()=>{const a=await x();s.value=a}),()=>l(q,{options:s.value,showSearch:!0,expandTrigger:"hover",value:[e.file_path],onChange:a=>{e.file_path=a.join("/")},placeholder:"请选择文件路径"},null)}}),rules:[{required:!0,type:"string",message:"File Path不能为空"}],vIf:e=>e.values.type==="file"},{field:"file_sheet_name",component:"Input",label:"Sheet名称(不填默认为第一个Sheet)",componentProps:{placeholder:""},vIf:e=>e.values.type==="file"&&e.values.file_type==="excel"}],D=[{field:"deep_optimization",component:"Switch",label:"是否开启深度优化",defaultValue:!1,helpMessage:"开启深度优化，将会把查询压力上升给数据源，但是可以大大减少io压力，请谨慎使用",vIf:e=>["postgres","mysql","gbase","clickhouse"].includes(e.values.type)}],A=[{field:"mysql_host",component:"Input",label:"主机地址",componentProps:{placeholder:""},rules:[{required:!0,type:"string",message:"host不能为空"}],vIf:e=>e.values.type==="mysql"},{field:"mysql_port",component:"InputNumber",label:"端口",componentProps:{placeholder:""},vIf:e=>e.values.type==="mysql",rules:[{required:!0,type:"number",message:"port不能为空"}]},{field:"mysql_username",component:"Input",componentProps:{placeholder:""},label:"用户名",vIf:e=>e.values.type==="mysql",rules:[{required:!0,type:"string",message:"用户名不能为空"}]},{field:"mysql_password",component:"Input",componentProps:{placeholder:"",type:"password"},label:"密码",rules:[{required:!0,type:"string",message:"密码不能为空"}],vIf:e=>e.values.type==="mysql"},{field:"mysql_database",component:"Input",componentProps:{placeholder:""},label:"数据库",rules:[{required:!0,type:"string",message:"数据库不能为空"}],vIf:e=>e.values.type==="mysql"}],C=[{field:"gbase_host",component:"Input",label:"主机地址",componentProps:{placeholder:""},rules:[{required:!0,type:"string",message:"host不能为空"}],vIf:e=>e.values.type==="gbase"},{field:"gbase_port",component:"InputNumber",label:"端口",componentProps:{placeholder:""},vIf:e=>e.values.type==="gbase",rules:[{required:!0,type:"number",message:"port不能为空"}]},{field:"gbase_username",component:"Input",componentProps:{placeholder:""},label:"用户名",vIf:e=>e.values.type==="gbase",rules:[{required:!0,type:"string",message:"用户名不能为空"}]},{field:"gbase_password",component:"Input",componentProps:{placeholder:"",type:"password"},label:"密码",rules:[{required:!0,type:"string",message:"密码不能为空"}],vIf:e=>e.values.type==="gbase"},{field:"gbase_database",component:"Input",componentProps:{placeholder:""},label:"数据库",rules:[{required:!0,type:"string",message:"数据库不能为空"}],vIf:e=>e.values.type==="gbase"}],F=[{field:"clickhouse_host",component:"Input",label:"主机地址",componentProps:{placeholder:""},rules:[{required:!0,type:"string",message:"host不能为空"}],vIf:e=>e.values.type==="clickhouse"},{field:"clickhouse_port",component:"InputNumber",label:"端口",componentProps:{placeholder:""},vIf:e=>e.values.type==="clickhouse",rules:[{required:!0,type:"number",message:"port不能为空"}]},{field:"clickhouse_username",component:"Input",componentProps:{placeholder:""},label:"用户名",vIf:e=>e.values.type==="clickhouse",rules:[{required:!0,type:"string",message:"用户名不能为空"}]},{field:"clickhouse_password",component:"Input",componentProps:{placeholder:"",type:"password"},label:"密码",rules:[{required:!0,type:"string",message:"密码不能为空"}],vIf:e=>e.values.type==="clickhouse"},{field:"clickhouse_database",component:"Input",componentProps:{placeholder:""},label:"数据库",rules:[{required:!0,type:"string",message:"数据库不能为空"}],vIf:e=>e.values.type==="clickhouse"}],N=[{field:"dm_host",component:"Input",label:"主机地址",componentProps:{placeholder:""},rules:[{required:!0,type:"string",message:"host不能为空"}],vIf:e=>e.values.type==="dm"},{field:"dm_port",component:"InputNumber",label:"端口",componentProps:{placeholder:""},vIf:e=>e.values.type==="dm",rules:[{required:!0,type:"number",message:"port不能为空"}]},{field:"dm_username",component:"Input",componentProps:{placeholder:""},label:"用户名",vIf:e=>e.values.type==="dm",rules:[{required:!0,type:"string",message:"用户名不能为空"}]},{field:"dm_password",component:"Input",componentProps:{placeholder:"",type:"password"},label:"密码",rules:[{required:!0,type:"string",message:"密码不能为空"}],vIf:e=>e.values.type==="dm"},{field:"dm_database",component:"Input",componentProps:{placeholder:""},label:"数据库",rules:[{required:!0,type:"string",message:"数据库不能为空"}],vIf:e=>e.values.type==="dm"}],M=[{field:"pg_host",component:"Input",label:"主机地址",componentProps:{placeholder:""},rules:[{required:!0,type:"string",message:"host不能为空"}],vIf:e=>e.values.type==="postgres"},{field:"pg_port",component:"InputNumber",label:"端口",componentProps:{placeholder:""},vIf:e=>e.values.type==="postgres",rules:[{required:!0,type:"number",message:"port不能为空"}]},{field:"pg_username",component:"Input",componentProps:{placeholder:""},label:"用户名",vIf:e=>e.values.type==="postgres",rules:[{required:!0,type:"string",message:"用户名不能为空"}]},{field:"pg_password",component:"Input",componentProps:{placeholder:"",type:"password"},label:"密码",rules:[{required:!0,type:"string",message:"密码不能为空"}],vIf:e=>e.values.type==="postgres"},{field:"pg_database",component:"Input",componentProps:{placeholder:""},label:"数据库",rules:[{required:!0,type:"string",message:"数据库不能为空"}],vIf:e=>e.values.type==="postgres"},{field:"pg_schema",component:"Input",componentProps:{placeholder:""},label:"Schema",vIf:e=>e.values.type==="postgres",rules:[{required:!0,type:"string",message:"Schema不能为空"}]}],O=[{field:"name",component:"Input",componentProps:{placeholder:""},label:"连接名称",rules:[{required:!0,type:"string",message:"请输入连接名称"},{pattern:/^[a-zA-Z0-9_]+$/,message:"名称只能包含字母、数字和下划线"}]},{field:"description",component:"InputTextArea",label:"Database描述",helpMessage:"Database的描述,将会在Agent的prompt中使用，可以提高模型判断使用数据库的准确性",componentProps:{placeholder:"",rows:2},defaultValue:"",rules:[{required:!0,type:"string",message:"请输入RAG的功能描述"}]},{field:"rag_names",component:"Select",componentProps:()=>({mode:"multiple",defaultActiveFirstOption:!1,optionLabelProp:"value",request:()=>S(),placeholder:""}),label:"关联RAG"},{field:"type",component:"Select",componentProps:{placeholder:"",options:[{label:"Mysql",value:"mysql"},{label:"Postgres",value:"postgres"},{label:"File",value:"file"},{label:"Gbase",value:"gbase"},{label:"Clickhouse",value:"clickhouse"},{label:"DM",value:"dm"}]},rules:[{required:!0,type:"string",message:"数据库类型不能为空"}],label:"数据库类型"},{field:"enabled",component:"Switch",label:"是否启用"},...D,...A,...M,...C,...F,...N,...z],ke=c({setup:()=>{const[e,s]=P(),[a]=v(),n=async o=>{const[m]=await a({modalProps:{title:`${o.id?"编辑":"新增"}`,width:"50%",onFinish:async t=>{let r={};switch(t.type){case"mysql":r={mysql_host:t.mysql_host,mysql_port:t.mysql_port,mysql_username:t.mysql_username,mysql_password:t.mysql_password,mysql_database:t.mysql_database,deep_optimization:t.deep_optimization??!1};break;case"gbase":r={gbase_host:t.gbase_host,gbase_port:t.gbase_port,gbase_username:t.gbase_username,gbase_password:t.gbase_password,gbase_database:t.gbase_database,deep_optimization:t.deep_optimization??!1};break;case"clickhouse":r={clickhouse_host:t.clickhouse_host,clickhouse_port:t.clickhouse_port,clickhouse_username:t.clickhouse_username,clickhouse_password:t.clickhouse_password,clickhouse_database:t.clickhouse_database,deep_optimization:t.deep_optimization??!1};break;case"dm":r={dm_host:t.dm_host,dm_port:t.dm_port,dm_username:t.dm_username,dm_password:t.dm_password,dm_database:t.dm_database,deep_optimization:t.deep_optimization??!1};break;case"postgres":r={pg_host:t.pg_host,pg_port:t.pg_port,pg_username:t.pg_username,pg_password:t.pg_password,pg_database:t.pg_database,pg_schema:t.pg_schema,deep_optimization:t.deep_optimization??!1};break;case"file":r={file_type:t.file_type,file_system:t.file_system,file_path:t.file_path,file_sheet_name:t.file_sheet_name};break}if(o.id){let u={...t,id:o.id,enabled:t.enabled?1:0,config:JSON.stringify(r)};await p.ai.updateDatabase(u)}else await p.ai.addDatabase({...t,enabled:t.enabled?1:0,config:JSON.stringify(r)});s==null||s.reload()}},formProps:{layout:"vertical",schemas:O}});m==null||m.setFieldsValue({...o,enabled:o.enabled===1})},i=async o=>{await p.ai.deleteDatabase(o),s==null||s.reload()},b=[...k,{title:"操作",width:130,dataIndex:"ACTION",hideInSearch:!0,fixed:"right",actions:({record:o})=>[{label:"Edit",onClick:async()=>{const m=await p.ai.getDatabaseById(o.id),{config:t,...r}=m,u=JSON.parse(t);n({...r,...u})}},{label:"Delete",danger:!0,popConfirm:{title:"Are you sure you want to delete this model?",placement:"left",onConfirm:()=>{o.id&&i(o.id)}}}]}];return()=>l("div",{class:"w-full h-full overflow-scroll container px-4 py-5"},[l(e,{rowKey:"id",headerTitle:"Database List",columns:b,bordered:!0,size:"small",dataRequest:p.ai.listDatabases},{toolbar:()=>l(_,{type:"primary",onClick:()=>n({enabled:1})},{default:()=>[I("Add")]})})])}});export{ke as default};
