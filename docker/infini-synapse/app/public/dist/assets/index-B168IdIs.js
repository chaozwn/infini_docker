import{f as b}from"./dateUtil-CsedNW7R.js";import{T as g}from"./index-BV8c2Nm-.js";import{c as s,G as v,d as w,r as p,bi as C,w as T,o as S,h as O,q as U,B,E as N,F as R,as as h}from"./index-CP_NLk5V.js";import{u as A}from"./dynamic-table-JSGoDHP1.js";import"./ApiSelect.vue_vue_type_script_setup_true_lang-rDwSI5B1.js";import{_ as D}from"./FullscreenOutlined-EljRxNfp.js";import"./index-D71WF9tc.js";import"./index-ui2LYhtl.js";import"./_baseUniq-CFFQq6dw.js";import"./_arrayIncludesWith-DbV0gfeD.js";import"./collapseMotion-IEGzNviF.js";import"./move-DnuFh34z.js";import"./RightOutlined-b1GVfhJ5.js";import"./index-D_-O6rwg.js";import"./index-qSWTwERE.js";import"./isMobile-BbN7I0i_.js";import"./useMergedState-Df90kDYb.js";import"./DownOutlined-CFbTkQpD.js";import"./CheckOutlined-Cdt44iMS.js";import"./VerticalRightOutlined-De0bo4mZ.js";import"./cloneDeep-Be4MLehs.js";import"./index-BbOUjhHY.js";import"./index-D-YWnkJu.js";import"./useFlexGapSupport-C1UkMKsL.js";import"./index-DGspTBaA.js";import"./_castArrayLikeObject-ILv2M5FZ.js";import"./index-DkkXTBW6.js";import"./LeftOutlined-BDcNQYUt.js";import"./zh_CN-CAyhejr6.js";import"./index-C8mpr5is.js";import"./FileOutlined-BhArWp4e.js";import"./debounce-Yn7_oL9X.js";import"./Text-BJ9iz6Il.js";import"./EnterOutlined-CX4WQ0WC.js";import"./CopyOutlined-CKDHFiKQ.js";import"./index-B9_A_Raz.js";import"./useRefs-Dv5vkZVi.js";import"./QuestionCircleOutlined-DrJxdn7s.js";import"./isNumber-Dd3hUNF9.js";import"./index-bem_Mg93.js";import"./index-BalfchpH.js";import"./index-CkcvDGSF.js";import"./pick-B4-lyv4c.js";const E=[{title:"会话编号",dataIndex:"tokenId",ellipsis:!0,hideInSearch:!0},{title:"用户名",dataIndex:"username",customRender:({record:t})=>s("div",null,[s("span",{class:"pr-[4px]"},[t.username]),t.isCurrent&&s(g,{color:"processing"},{default:()=>[v("我")]})])},{title:"部门名称",dataIndex:"deptName"},{title:"登录IP",dataIndex:"ip",width:140},{title:"登录地点",dataIndex:"address"},{title:"浏览器",dataIndex:"browser"},{title:"操作系统",dataIndex:"os"},{title:"登录时间",dataIndex:"time",width:180,customRender:({record:t})=>b(t.time)}],Ce=w({name:"SystemMonitorOnline",__name:"index",setup(t){let l=[];const r=p(!0),m=p([]),d=p(!1),c=C(),[f,I]=A({size:"small"}),k=[...E,{title:"操作",width:80,dataIndex:"ACTION",actions:({record:e})=>[{label:"下线",auth:"system:online:kick",disabled:e.disable,popConfirm:{title:"确定下线该用户吗?",onConfirm:()=>x(e)}}]}],x=async e=>{await h.systemOnline.onlineKick({tokenId:e.tokenId}),I.reload()},_=(...e)=>{[...e]},y=e=>{const i=Object.keys(e);if(!i.some(n=>!!e[n])){o();return}m.value=l.filter(n=>i.every(a=>!e[a]||n[a].includes(e[a])))},o=async()=>{d.value=!0,l=await h.systemOnline.onlineList().finally(()=>d.value=!1),m.value=l},u=()=>{r.value&&o()};return T(r,e=>{e&&o()}),S(()=>{o(),c.emitter.on("onlineUser",u)}),O(()=>{c.emitter.off("onlineUser",u)}),(e,i)=>{const n=D;return U(),B(R(f),{"row-key":"tokenId","header-title":"在线用户","title-tooltip":"这是真实操作，请不要随意将其他用户踢下线。","data-source":m.value,columns:k,loading:d.value,onChange:_,onSearch:y,onReload:o},{toolbar:N(()=>[s(n,{checked:r.value,"onUpdate:checked":i[0]||(i[0]=a=>r.value=a),"checked-children":"开启实时更新","un-checked-children":"关闭实时更新"},null,8,["checked"])]),_:1},8,["data-source","loading"])}}});export{Ce as default};
