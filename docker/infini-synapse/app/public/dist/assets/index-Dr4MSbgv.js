import{c as t,I as x,bP as P,d as R,D as S,r as m,o as $,as as f,M as z,G as g,aS as v}from"./index-BOVJKpu-.js";import{D as c}from"./index-DhP6q4fW.js";import{P as C,a as j}from"./Text-D0ktBGfu.js";import{C as H}from"./index-B6ASyAra.js";import{A as V}from"./index-47Va5tV1.js";import"./EnterOutlined-DpcDiPLG.js";import"./CheckOutlined-qbl41G6h.js";import"./CopyOutlined-CAcHqZdD.js";import"./useMergedState-DqMtpKK1.js";import"./index-CPhZyD85.js";import"./index-3nwZP43T.js";import"./_baseUniq-DjpvkF72.js";import"./_arrayIncludesWith-DbV0gfeD.js";import"./collapseMotion-B0DV22gP.js";import"./useRefs-DzKegIYG.js";import"./pick-CjHNRSnr.js";import"./isMobile-BbN7I0i_.js";import"./PlusOutlined-gxkihAGd.js";var k={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M916 210H376c-17.7 0-32 14.3-32 32v236H108c-17.7 0-32 14.3-32 32v272c0 17.7 14.3 32 32 32h540c17.7 0 32-14.3 32-32V546h236c17.7 0 32-14.3 32-32V242c0-17.7-14.3-32-32-32zm-504 68h200v200H412V278zm-68 468H144V546h200v200zm268 0H412V546h200v200zm268-268H680V278h200v200z"}}]},name:"build",theme:"outlined"};function E(l){for(var e=1;e<arguments.length;e++){var u=arguments[e]!=null?Object(arguments[e]):{},n=Object.keys(u);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(u).filter(function(o){return Object.getOwnPropertyDescriptor(u,o).enumerable}))),n.forEach(function(o){G(l,o,u[o])})}return l}function G(l,e,u){return e in l?Object.defineProperty(l,e,{value:u,enumerable:!0,configurable:!0,writable:!0}):l[e]=u,l}var b=function(e,u){var n=E({},e,u.attrs);return t(x,E({},n,{icon:k}),null)};b.displayName="BuildOutlined";b.inheritAttrs=!1;var N={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z"}}]},name:"sync",theme:"outlined"};function O(l){for(var e=1;e<arguments.length;e++){var u=arguments[e]!=null?Object(arguments[e]):{},n=Object.keys(u);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(u).filter(function(o){return Object.getOwnPropertyDescriptor(u,o).enumerable}))),n.forEach(function(o){q(l,o,u[o])})}return l}function q(l,e,u){return e in l?Object.defineProperty(l,e,{value:u,enumerable:!0,configurable:!0,writable:!0}):l[e]=u,l}var h=function(e,u){var n=O({},e,u.attrs);return t(x,O({},n,{icon:N}),null)};h.displayName="SyncOutlined";h.inheritAttrs=!1;const A=P,oe=R({setup:()=>{const l=S(),e=m(),u=m(!1),n=m(),o=m(null),p=m();$(async()=>{const s=l.currentRoute.value.params.rag_name,r=await f.ai.getRagByName(s);e.value=r,r.enable_hybrid_index||(z.error("此RAG实例不支持构建缓存功能。只有Pro版本且启用了混合索引的实例才能构建缓存。"),l.push("/ai/rag/instances"));const i=await f.ai.getRagBuildCacheLog(s);n.value=i});const D=async()=>{var s,r,i;try{u.value=!0,n.value={log:"",taskInfo:void 0};const a={};(s=e.value)!=null&&s.emb_model&&(a.emb_model=e.value.emb_model),(r=e.value)!=null&&r.name?(await f.ai.buildRagCache((i=e.value)==null?void 0:i.name),v.success({message:"缓存构建已经开始",description:"构建过程可能需要一些时间，请耐心等待。您可以在此页面查看构建日志。"})):(v.error({message:"构建缓存失败",description:"RAG实例名称不能为空"}),u.value=!1),I()}catch(a){console.error("构建缓存失败:",a),v.error({message:"构建缓存失败",description:`构建缓存失败, Reason: ${a}，请稍后重试。`}),u.value=!1}},w=()=>{p.value&&(p.value.scrollTop=p.value.scrollHeight)},I=()=>{o.value&&clearInterval(o.value);const s=setInterval(async()=>{var i,a,d;const r=await f.ai.getRagBuildCacheLog(((i=e.value)==null?void 0:i.name)??"");n.value={...n.value,log:r.log},w(),(a=r.taskInfo)!=null&&a.completed&&(v.success({message:"缓存构建完成",description:(d=r.taskInfo)!=null&&d.success?"缓存构建成功！":"缓存构建失败，请查看日志了解详情。"}),o.value&&clearInterval(o.value),o.value=null,u.value=!1)},2e3);o.value=s};return()=>{var s;return t("div",{class:"container px-4 py-5 flex flex-col h-full overflow-scroll"},[t("header",{class:"flex gap-4 items-center"},[t(A,{onClick:()=>{l.push("/ai/rag/instances")}},{default:()=>[g("返回RAG列表")]})]),t("main",{class:"flex flex-col gap-4 pt-4"},[t(c,{title:"RAG实例信息",bordered:!0},{default:()=>{var r,i;return[t(c.Item,{label:"名称",span:3},{default:()=>{var a;return[(a=e.value)==null?void 0:a.name]}}),t(c.Item,{label:"模型",span:3},{default:()=>{var a;return[(a=e.value)==null?void 0:a.model]}}),((r=e.value)==null?void 0:r.emb_model)&&t(c.Item,{label:"向量模型",span:3},{default:()=>{var a;return[(a=e.value)==null?void 0:a.emb_model]}}),((i=e.value)==null?void 0:i.rag_storage_type)&&t(c.Item,{label:"存储引擎",span:3},{default:()=>{var a;return[((a=e.value)==null?void 0:a.rag_storage_type)==="duckdb"?"DuckDB":"Byzer Storage"]}}),t(c.Item,{label:"文档目录",span:3},{default:()=>{var a;return[(a=e.value)==null?void 0:a.doc_dir]}}),t(c.Item,{label:"文件类型",span:3},{default:()=>{var a;return[((a=e.value)==null?void 0:a.required_exts)||".md,.rst,.txt"]}})]}}),t(V,{type:"info",message:"构建缓存说明",description:t("div",null,[t(C,null,{default:()=>[g("构建缓存将为RAG服务创建预处理的混合索引，可以显著提高检索效率和结果质量。构建过程可能需要一些时间， 具体取决于文档数量和复杂度。")]}),t(C,null,{default:()=>[g("将执行的命令:")," ",t(j,{code:!0},{default:()=>{var r,i,a,d,y,_,F,B;return[`auto-coder.rag build_hybrid_index --model ${(r=e.value)==null?void 0:r.model} ${(i=e.value)!=null&&i.emb_model?`--emb_model ${(a=e.value)==null?void 0:a.emb_model}`:""} --doc_dir ${(d=e.value)==null?void 0:d.doc_dir} ${(y=e.value)!=null&&y.required_exts?`--required_exts ${(_=e.value)==null?void 0:_.required_exts}`:""} ${(F=e.value)!=null&&F.rag_storage_type?`--rag_storage_type ${(B=e.value)==null?void 0:B.rag_storage_type}`:""} --enable_hybrid_index`]}})]})]),showIcon:!0},null),t(A,{type:"primary",icon:u.value?t(h,{spin:!0},null):t(b,null,null),onClick:D,loading:u.value,disabled:u.value,size:"large",block:!0},{default:()=>{var r;return[(r=n.value)!=null&&r.log?"重新构建":u.value?"正在构建缓存...":"开始构建缓存"]}}),t(H,{title:"构建日志",type:"inner",style:{display:(s=n.value)!=null&&s.log||u.value?"block":"none"}},{default:()=>{var r;return[t("pre",{ref:p,style:{whiteSpace:"pre-wrap",wordWrap:"break-word",height:"400px",overflowY:"auto",backgroundColor:"#f5f5f5",padding:"12px",borderRadius:"4px",fontSize:"12px",lineHeight:"1.5",fontFamily:"monospace"}},[((r=n.value)==null?void 0:r.log)||"等待构建开始..."])]}})])])}}});export{oe as default};
